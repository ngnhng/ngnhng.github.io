---
import { getCollection } from "astro:content";
import type { ImageMetadata } from "astro";
import Card from "./Card.astro";

interface Props {
  query: Query;
}

export interface Query {
  categories: string | string[];
  sortBy: "date" | "title";
}

const { query } = Astro.props;

const blogPosts = await getCollection("notes");

const posts = blogPosts.filter((post) => {
  if (query.categories === "*") return true;
  return query.categories.includes(post.data.category);
});

const sortedPosts = posts.sort((a, b) => {
  if (query.sortBy === "date") {
    return (
      new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
    );
  }
  return a.data.title.localeCompare(b.data.title);
});
---

<div class="space-y-12">
  {
    sortedPosts && sortedPosts.at(0) && (
      <Card
        imagePath={sortedPosts.at(0)?.data.image ?? ""}
        altText={sortedPosts.at(0)?.data.imageAlt ?? ""}
        name={sortedPosts.at(0)?.data.title ?? ""}
        category={sortedPosts.at(0)?.data.category ?? ""}
        date={sortedPosts.at(0)?.data.pubDate.toDateString() ?? ""}
        href={`/notes/${sortedPosts.at(0)?.data.slug}`}
        large
      />
    )
  }
  <!-- <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    {
      sortedPosts.slice(1).map((post) => (
        <ArticleCard
          category={post.data.category}
          title={post.data.title}
          date={post.data.pubDate.toDateString()}
          href={`/notes/${post.data.slug}`}
        >
          <Image
            src={images[post.data.image ?? ""]()}
            alt={post.data.imageAlt ?? ""}
          />
        </ArticleCard>
      ))
    }
  </div> -->
</div>
